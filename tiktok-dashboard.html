<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>TikTok-Style Social Commerce - D'Xpress</title>
    <meta name="description" content="Experience the future of e-commerce with D'Xpress TikTok-style social commerce dashboard featuring real-time interactions and premium products">
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Stylesheets -->
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="css/tiktok-dashboard.css">
    
    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%236D28D9'%3e%3cpath d='M3 3h8v8H3V3zm10 0h8v8h-8V3zM3 13h8v8H3v-8zm10 0h8v8h-8v-8z'/%3e%3c/svg%3e">
</head>
<body class="tiktok-container">
    <!-- TikTok Feed Container -->
    <div class="tiktok-feed" id="tiktokFeed">
        <!-- Loading State -->
        <div class="tiktok-loading" id="tiktokLoading">
            <div style="text-align: center;">
                <div class="loading-spinner" style="margin-bottom: 16px;"></div>
                <h3>Loading Social Commerce...</h3>
                <p style="opacity: 0.7;">Preparing your personalized feed</p>
            </div>
        </div>
    </div>

    <!-- Top Navigation -->
    <div class="ui-overlay">
        <div class="top-nav">
            <a href="index.html" class="tiktok-logo">D'Xpress</a>
            
            <div class="nav-tabs">
                <a href="#" class="nav-tab active" onclick="switchFeed('forYou')">For You</a>
                <a href="#" class="nav-tab" onclick="switchFeed('following')">Following</a>
                <a href="#" class="nav-tab" onclick="switchFeed('trending')">Trending</a>
                <a href="#" class="nav-tab" onclick="switchFeed('deals')">Deals</a>
            </div>
            
            <button class="close-btn" onclick="closeTikTokDashboard()">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <line x1="18" y1="6" x2="6" y2="18"/>
                    <line x1="6" y1="6" x2="18" y2="18"/>
                </svg>
            </button>
        </div>
    </div>

    <!-- Gesture Hint (Mobile) -->
    <div class="gesture-hint" id="gestureHint">
        <div class="gesture-arrow">
            <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <polyline points="6,9 12,15 18,9"/>
            </svg>
        </div>
        <p style="font-size: 14px;">Swipe up to explore more products</p>
    </div>

    <!-- Scripts -->
    <script src="js/script.js"></script>
    <script src="js/tiktok-dashboard.js"></script>
    <script src="js/auth.js"></script>
    
    <script>
        // TikTok Dashboard Functionality
        let currentFeedType = 'forYou';
        let currentSlideIndex = 0;
        let socialData = {
            likes: JSON.parse(localStorage.getItem('dx_user_likes') || '[]'),
            follows: JSON.parse(localStorage.getItem('dx_user_follows') || '[]'),
            shares: JSON.parse(localStorage.getItem('dx_user_shares') || '[]'),
            comments: JSON.parse(localStorage.getItem('dx_user_comments') || '[]')
        };
        
        let vendorData = [
            {
                id: 1,
                name: "TechHub Store",
                avatar: "https://images.unsplash.com/photo-1472099645785-5658abf4ff4e?w=100&h=100&fit=crop&crop=face",
                followers: 15420,
                isFollowed: false
            },
            {
                id: 2,
                name: "Fashion Forward",
                avatar: "https://images.unsplash.com/photo-1494790108755-2616b612b786?w=100&h=100&fit=crop&crop=face",
                followers: 23750,
                isFollowed: false
            },
            {
                id: 3,
                name: "Home Essentials",
                avatar: "https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?w=100&h=100&fit=crop&crop=face",
                followers: 8950,
                isFollowed: false
            },
            {
                id: 4,
                name: "Style Accessories",
                avatar: "https://images.unsplash.com/photo-1500648767791-00dcc994a43e?w=100&h=100&fit=crop&crop=face",
                followers: 12180,
                isFollowed: false
            }
        ];

        // Initialize TikTok Dashboard
        document.addEventListener('DOMContentLoaded', function() {
            // Check authentication
            if (!isLoggedIn()) {
                showLoginPrompt();
                return;
            }

            initializeTikTokFeed();
            setupMobileGestures();
            trackEvent('tiktok_dashboard_opened', {
                user: currentUser.email,
                timestamp: new Date().toISOString()
            });
        });

        // Show login prompt for unauthenticated users
        function showLoginPrompt() {
            const container = document.getElementById('tiktokFeed');
            container.innerHTML = `
                <div class="tiktok-error">
                    <svg width="80" height="80" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1" style="margin-bottom: 24px; opacity: 0.5;">
                        <circle cx="12" cy="12" r="10"/>
                        <line x1="12" y1="16" x2="12" y2="12"/>
                        <line x1="12" y1="8" x2="12.01" y2="8"/>
                    </svg>
                    <h3>Login Required</h3>
                    <p style="margin-bottom: 24px;">Please login to access the social commerce dashboard</p>
                    <a href="login.html" class="btn btn-primary">Login Now</a>
                </div>
            `;
        }

        // Initialize TikTok feed
        async function initializeTikTokFeed() {
            const container = document.getElementById('tiktokFeed');
            const loading = document.getElementById('tiktokLoading');
            
            try {
                // Get products for current feed
                const products = await getFeedProducts(currentFeedType);
                
                // Hide loading
                loading.style.display = 'none';
                
                // Create slides
                container.innerHTML = '';
                products.forEach((product, index) => {
                    const slide = createProductSlide(product, index);
                    container.appendChild(slide);
                });
                
                // Setup feed controls
                setupFeedControls(products.length);
                
                // Start at first slide
                currentSlideIndex = 0;
                updateSlidePosition();
                
            } catch (error) {
                console.error('Error initializing feed:', error);
                showFeedError();
            }
        }

        // Get products for different feed types
        async function getFeedProducts(feedType) {
            let products = [];
            
            switch (feedType) {
                case 'forYou':
                    products = getProducts().sort(() => Math.random() - 0.5);
                    break;
                case 'following':
                    // Simulate following-based recommendations
                    products = getProducts().slice(0, 6);
                    break;
                case 'trending':
                    products = getProducts()
                        .sort((a, b) => (b.rating * b.reviews) - (a.rating * a.reviews))
                        .slice(0, 8);
                    break;
                case 'deals':
                    products = getProducts()
                        .filter(p => p.price < 300)
                        .sort((a, b) => a.price - b.price);
                    break;
                default:
                    products = getProducts();
            }
            
            return products;
        }

        // Create individual product slide
        function createProductSlide(product, index) {
            const slide = document.createElement('div');
            slide.className = 'tiktok-slide slide-transition';
            slide.dataset.productId = product.id;
            
            const vendor = vendorData[index % vendorData.length];
            const isLiked = socialData.likes.includes(product.id);
            const isFollowed = socialData.follows.includes(vendor.id);
            const isShared = socialData.shares.includes(product.id);
            const shareCount = Math.floor(Math.random() * 500) + 50;
            const commentCount = Math.floor(Math.random() * 100) + 10;
            
            slide.innerHTML = `
                <!-- Product Media -->
                <div class="product-media">
                    <img src="${product.image}" alt="${product.name}" class="product-image-carousel" loading="lazy">
                    
                    <!-- Video Overlay -->
                    <div class="video-overlay" onclick="toggleVideoPlayback(this)">
                        <div class="play-button">
                            <svg viewBox="0 0 24 24">
                                <path d="M8 5v14l11-7z"/>
                            </svg>
                        </div>
                    </div>
                </div>
                
                <!-- Bottom Product Info -->
                <div class="bottom-info">
                    <div class="product-details">
                        <div class="product-category">${product.category}</div>
                        <h3 class="product-title">${product.name}</h3>
                        <p class="product-description">${product.description}</p>
                        
                        <div class="product-features">
                            ${product.features.slice(0, 3).map(feature => `
                                <span class="feature-tag">${feature}</span>
                            `).join('')}
                        </div>
                        
                        <div class="product-price">${formatCurrency(product.price)}</div>
                        
                        <div class="product-stats">
                            <div class="stat-item">
                                <svg class="stat-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <polygon points="12,2 15.09,8.26 22,9.27 17,14.14 18.18,21.02 12,17.77 5.82,21.02 7,14.14 2,9.27 8.91,8.26"/>
                                </svg>
                                <span>${product.rating}</span>
                            </div>
                            <div class="stat-item">
                                <svg class="stat-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"/>
                                </svg>
                                <span>${Math.floor(Math.random() * 1000) + 100}</span>
                            </div>
                            <div class="stat-item">
                                <svg class="stat-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <polyline points="23,4 23,10 17,10"/>
                                    <polyline points="1,20 1,14 7,14"/>
                                    <path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"/>
                                </svg>
                                <span>${shareCount}</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="action-buttons">
                        <button class="btn-action btn-primary-action" onclick="addToCartFromTikTok(${product.id})">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="9" cy="21" r="1"/>
                                <circle cx="20" cy="21" r="1"/>
                                <path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"/>
                            </svg>
                            Add to Cart
                        </button>
                        <button class="btn-action btn-secondary-action" onclick="viewProductDetails(${product.id})">
                            View Details
                        </button>
                    </div>
                </div>
                
                <!-- Right Rail Interactions -->
                <div class="right-rail">
                    <div class="rail-item">
                        <button class="rail-button ${isLiked ? 'liked' : ''}" onclick="toggleLike(${product.id}, this)">
                            <svg viewBox="0 0 24 24">
                                <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"/>
                            </svg>
                        </button>
                        <span class="rail-count">${isLiked ? Math.floor(Math.random() * 100) + 1 : Math.floor(Math.random() * 50)}</span>
                    </div>
                    
                    <div class="rail-item">
                        <button class="rail-button" onclick="showComments(${product.id})">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/>
                            </svg>
                        </button>
                        <span class="rail-count">${commentCount}</span>
                    </div>
                    
                    <div class="rail-item">
                        <button class="rail-button ${isShared ? 'shared' : ''}" onclick="shareProduct(${product.id}, this)">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="18" cy="5" r="3"/>
                                <circle cx="6" cy="12" r="3"/>
                                <circle cx="18" cy="19" r="3"/>
                                <line x1="8.59" y1="13.51" x2="15.42" y2="17.49"/>
                                <line x1="15.41" y1="6.51" x2="8.59" y2="10.49"/>
                            </svg>
                        </button>
                        <span class="rail-count">${shareCount}</span>
                    </div>
                    
                    <div class="rail-item">
                        <button class="rail-button ${isFollowed ? 'followed' : ''}" onclick="followVendor(${vendor.id}, this)">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/>
                                <circle cx="8.5" cy="7" r="4"/>
                                <path d="M20 8v6"/>
                                <path d="M23 11l-3 3-3-3"/>
                            </svg>
                        </button>
                        <span class="rail-count">${vendor.followers.toLocaleString()}</span>
                    </div>
                    
                    <div class="vendor-info">
                        <img src="${vendor.avatar}" alt="${vendor.name}" class="vendor-avatar" loading="lazy">
                        <div class="vendor-name">${vendor.name}</div>
                    </div>
                </div>
            `;
            
            return slide;
        }

        // Setup feed controls (dots indicator)
        function setupFeedControls(totalSlides) {
            const controlsContainer = document.createElement('div');
            controlsContainer.className = 'feed-controls';
            controlsContainer.id = 'feedControls';
            
            for (let i = 0; i < totalSlides; i++) {
                const indicator = document.createElement('div');
                indicator.className = `indicator ${i === 0 ? 'active' : ''}`;
                indicator.onclick = () => goToSlide(i);
                controlsContainer.appendChild(indicator);
            }
            
            document.querySelector('.ui-overlay').appendChild(controlsContainer);
        }

        // Update slide position
        function updateSlidePosition() {
            const slides = document.querySelectorAll('.tiktok-slide');
            const feed = document.getElementById('tiktokFeed');
            
            if (slides[currentSlideIndex]) {
                slides[currentSlideIndex].scrollIntoView({ behavior: 'smooth' });
                updateIndicators();
            }
        }

        // Update indicators
        function updateIndicators() {
            const indicators = document.querySelectorAll('.indicator');
            indicators.forEach((indicator, index) => {
                indicator.classList.toggle('active', index === currentSlideIndex);
            });
        }

        // Go to specific slide
        function goToSlide(index) {
            currentSlideIndex = index;
            updateSlidePosition();
            trackSlideView();
        }

        // Setup mobile gestures
        function setupMobileGestures() {
            const feed = document.getElementById('tiktokFeed');
            let startY = 0;
            let startTime = 0;
            
            feed.addEventListener('touchstart', function(e) {
                startY = e.touches[0].clientY;
                startTime = Date.now();
            });
            
            feed.addEventListener('touchend', function(e) {
                const endY = e.changedTouches[0].clientY;
                const endTime = Date.now();
                const deltaY = startY - endY;
                const deltaTime = endTime - startTime;
                
                // Only process quick swipes
                if (deltaTime < 300) {
                    if (deltaY > 50) {
                        // Swipe up - next slide
                        nextSlide();
                    } else if (deltaY < -50) {
                        // Swipe down - previous slide
                        prevSlide();
                    }
                }
            });
        }

        // Navigate slides
        function nextSlide() {
            const slides = document.querySelectorAll('.tiktok-slide');
            if (currentSlideIndex < slides.length - 1) {
                currentSlideIndex++;
                updateSlidePosition();
                trackSlideView();
            }
        }

        function prevSlide() {
            if (currentSlideIndex > 0) {
                currentSlideIndex--;
                updateSlidePosition();
                trackSlideView();
            }
        }

        // Social interaction functions
        function toggleLike(productId, button) {
            const isLiked = socialData.likes.includes(productId);
            
            if (isLiked) {
                socialData.likes = socialData.likes.filter(id => id !== productId);
                button.classList.remove('liked');
            } else {
                socialData.likes.push(productId);
                button.classList.add('liked');
                
                // Like animation
                button.style.animation = 'likeAnimation 0.6s ease-out';
                setTimeout(() => {
                    button.style.animation = '';
                }, 600);
            }
            
            // Save to localStorage
            localStorage.setItem('dx_user_likes', JSON.stringify(socialData.likes));
            
            // Track interaction
            trackEvent('product_liked', {
                productId: productId,
                liked: !isLiked,
                user: currentUser.email
            });
            
            showNotification(isLiked ? 'Removed from favorites' : 'Added to favorites', 'info');
        }

        function followVendor(vendorId, button) {
            const vendor = vendorData.find(v => v.id === vendorId);
            const isFollowed = socialData.follows.includes(vendorId);
            
            if (isFollowed) {
                socialData.follows = socialData.follows.filter(id => id !== vendorId);
                vendor.isFollowed = false;
                button.classList.remove('followed');
            } else {
                socialData.follows.push(vendorId);
                vendor.isFollowed = true;
                button.classList.add('followed');
                
                // Follow animation
                button.style.animation = 'followAnimation 0.6s ease-out';
                setTimeout(() => {
                    button.style.animation = '';
                }, 600);
            }
            
            // Save to localStorage
            localStorage.setItem('dx_user_follows', JSON.stringify(socialData.follows));
            
            // Track interaction
            trackEvent('vendor_followed', {
                vendorId: vendorId,
                vendorName: vendor.name,
                followed: !isFollowed,
                user: currentUser.email
            });
            
            showNotification(isFollowed ? `Unfollowed ${vendor.name}` : `Following ${vendor.name}`, 'info');
        }

        function shareProduct(productId, button) {
            const product = getProductById(productId);
            
            if (navigator.share) {
                navigator.share({
                    title: `Check out ${product.name} on D'Xpress`,
                    text: product.description,
                    url: window.location.href
                });
            } else {
                // Fallback - copy to clipboard
                const shareText = `Check out ${product.name} on D'Xpress: ${formatCurrency(product.price)} - ${product.description}`;
                navigator.clipboard.writeText(shareText);
                showNotification('Product link copied to clipboard!', 'success');
            }
            
            // Update share count
            if (!socialData.shares.includes(productId)) {
                socialData.shares.push(productId);
                localStorage.setItem('dx_user_shares', JSON.stringify(socialData.shares));
            }
            
            // Track interaction
            trackEvent('product_shared', {
                productId: productId,
                user: currentUser.email
            });
        }

        function showComments(productId) {
            showNotification('Comments feature coming soon!', 'info');
            
            trackEvent('comments_viewed', {
                productId: productId,
                user: currentUser.email
            });
        }

        // Product actions
        function addToCartFromTikTok(productId) {
            addToCart(productId);
            
            // Haptic feedback for mobile
            if (navigator.vibrate) {
                navigator.vibrate(100);
            }
        }

        function viewProductDetails(productId) {
            window.location.href = `product.html?id=${productId}`;
        }

        // Feed switching
        function switchFeed(feedType) {
            if (currentFeedType === feedType) return;
            
            currentFeedType = feedType;
            
            // Update active tab
            document.querySelectorAll('.nav-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            event.target.classList.add('active');
            
            // Reload feed
            initializeTikTokFeed();
            
            // Track feed switch
            trackEvent('feed_switched', {
                from: currentFeedType,
                to: feedType,
                user: currentUser.email
            });
        }

        // Video playback
        function toggleVideoPlayback(button) {
            const videoOverlay = button.parentElement;
            const mediaContainer = videoOverlay.parentElement;
            
            // This would typically handle video playback
            // For demo purposes, we'll just hide the overlay
            videoOverlay.style.display = 'none';
            
            trackEvent('video_playback_started', {
                user: currentUser.email
            });
        }

        // Close dashboard
        function closeTikTokDashboard() {
            // Track session
            trackEvent('tiktok_dashboard_closed', {
                duration: Date.now() - (window.tiktokStartTime || Date.now()),
                user: currentUser.email
            });
            
            window.location.href = 'index.html';
        }

        // Track slide views
        function trackSlideView() {
            const slide = document.querySelectorAll('.tiktok-slide')[currentSlideIndex];
            if (slide) {
                const productId = slide.dataset.productId;
                trackEvent('slide_viewed', {
                    productId: productId,
                    slideIndex: currentSlideIndex,
                    user: currentUser.email
                });
            }
        }

        // Show feed error
        function showFeedError() {
            const container = document.getElementById('tiktokFeed');
            const loading = document.getElementById('tiktokLoading');
            
            loading.style.display = 'none';
            container.innerHTML = `
                <div class="tiktok-error">
                    <svg width="80" height="80" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1" style="margin-bottom: 24px;">
                        <circle cx="12" cy="12" r="10"/>
                        <line x1="15" y1="9" x2="9" y2="15"/>
                        <line x1="9" y1="9" x2="15" y2="15"/>
                    </svg>
                    <h3>Unable to Load Feed</h3>
                    <p style="margin-bottom: 24px;">Something went wrong loading your social commerce feed</p>
                    <button class="btn btn-primary" onclick="initializeTikTokFeed()">Try Again</button>
                </div>
            `;
        }

        // Keyboard navigation
        document.addEventListener('keydown', function(e) {
            switch(e.key) {
                case 'ArrowUp':
                    e.preventDefault();
                    prevSlide();
                    break;
                case 'ArrowDown':
                    e.preventDefault();
                    nextSlide();
                    break;
                case 'Escape':
                    e.preventDefault();
                    closeTikTokDashboard();
                    break;
            }
        });

        // Track session start
        window.tiktokStartTime = Date.now();

        // Auto-hide gesture hint
        setTimeout(() => {
            const hint = document.getElementById('gestureHint');
            if (hint) {
                hint.style.opacity = '0';
                hint.style.transition = 'opacity 1s ease-out';
                setTimeout(() => hint.remove(), 1000);
            }
        }, 5000);

        console.log('üöÄ TikTok-Style Social Commerce Dashboard initialized!');
        console.log('üì± Swipe gestures enabled');
        console.log('‚ù§Ô∏è  Social interactions ready');
        console.log('üí± Philippine Peso products');
    </script>
</body>
</html>